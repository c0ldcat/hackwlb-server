<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title id="site-title">一段判断浏览器是否支持WebP的js代码 | c0ldcat's blog</title> <link rel="icon" href="/c0ldcat.png"> <link rel="stylesheet" type="text/css" href="/css/main.css"> <link rel="alternate" type="application/rss+xml" title="RSS Feed for c0ldcat's blog" href="/feed.xml" /> <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> <script type="text/javascript" src="/js/jquery.typetype.min.js"></script> <script> var _hmt = _hmt || []; (function () { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?e1acee033923881f5528a3b4a658039b"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <style> .block-left { background-size: cover; background-position-x: right; } </style> <!-- Begin Jekyll SEO tag v2.4.0 --> <title>一段判断浏览器是否支持WebP的js代码 | c0ldcat’s blog</title> <meta name="generator" content="Jekyll v3.7.3" /> <meta property="og:title" content="一段判断浏览器是否支持WebP的js代码" /> <meta name="author" content="c0ldcat" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="转自一段判断浏览器是否支持WebP的js代码 原作者: 关爱单身狗成长协会" /> <meta property="og:description" content="转自一段判断浏览器是否支持WebP的js代码 原作者: 关爱单身狗成长协会" /> <link rel="canonical" href="//blog.c0ldcat.ml/posts/test-support-of-webp/" /> <meta property="og:url" content="//blog.c0ldcat.ml/posts/test-support-of-webp/" /> <meta property="og:site_name" content="c0ldcat’s blog" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-08-30T12:25:36+08:00" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"//blog.c0ldcat.ml/posts/test-support-of-webp/"},"@type":"BlogPosting","url":"//blog.c0ldcat.ml/posts/test-support-of-webp/","dateModified":"2017-08-30T12:25:36+08:00","datePublished":"2017-08-30T12:25:36+08:00","headline":"一段判断浏览器是否支持WebP的js代码","author":{"@type":"Person","name":"c0ldcat"},"description":"转自一段判断浏览器是否支持WebP的js代码 原作者: 关爱单身狗成长协会","@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="block-left"> <div class="content"> <div class="main-info"> <a href="/" class="logo"><img src="/images/c0ldcat-pure-white.svg" class="logo"></a> <h1> <span id="author-name">c0ldcat</span><span>&#39;s blog</span> </h1> <ul> <li><a href="/posts" class="emoji-nav">🖊️</a></li> <li><a href="/projects" class="emoji-nav">🎈</a></li> <li><a href="/tags" class="emoji-nav">🔖</a></li> <li><a href="/love" class="emoji-nav">❤️</a></li> </ul> </div> </div> <canvas></canvas> </div> <div id="pages" class="block-right"> <div class="inner-post content"> <h1>一段判断浏览器是否支持WebP的js代码</h1> <div class="date-highlight">30 Aug 2017</div> <blockquote> <p>转自<a href="http://www.jianshu.com/p/cf60ad18c1c6">一段判断浏览器是否支持WebP的js代码</a> 原作者: 关爱单身狗成长协会</p> </blockquote> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">isSupportWebp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span><span class="c1">//是否支持</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span> 
    <span class="kd">function</span> <span class="nx">getResult</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//如果进入加载且图片宽度为1(通过图片宽度值判断图片是否可以显示)</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">isSupportWebp</span> <span class="o">=</span> <span class="nx">event</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'load'</span> <span class="p">?</span> <span class="nx">img</span><span class="p">.</span><span class="nx">width</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">getResult</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">getResult</span><span class="p">;</span>
    <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA='</span><span class="p">;</span> <span class="c1">//一像素图片</span>
<span class="p">})();</span>
</code></pre></div></div> <div class="date-highlight"> <!--1--> <a class="tag" href="/tag/web">Web</a> </div> </div> </div> <script src="/js/canvas.js"></script> <script> (function() { var img = new Image(); function getResult(event) { var imgType = "png"; (event && event.type === 'load' ? img.width == 1 : false) && (imgType = "webp"); $(".block-left").css("background-image", "linear-gradient(rgba(44, 45, 51, 0.8), rgba(44, 45, 51, 0.8)), url(/images/background.png)".replace(/\.png/,"." + imgType)); } img.onerror = getResult; img.onload = getResult; img.src = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA='; })(); </script> </body> </html>

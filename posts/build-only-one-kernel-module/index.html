<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title id="site-title">Linux Kernel 只编译一个module | c0ldcat's blog</title>
    <link rel="icon" href="/c0ldcat.png">
    <link rel="stylesheet" href="./../../css/style.css">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for c0ldcat's blog" href="/feed.xml" />
    <script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery.typetype.min.js"></script>
    <script type="text/javascript" src="/js/jquery.scrollTo.min.js"></script>
    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e1acee033923881f5528a3b4a658039b";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Linux Kernel 只编译一个module - c0ldcat’s blog</title>
<meta property="og:title" content="Linux Kernel 只编译一个module" />
<meta name="description" content="调试编译Linux Kernel有时会遇到这种情况, 辛辛苦苦编译了大半天却发现忘了个module. 然而Linux可插拔的module设计能够让我们单独编译单个module, 为我们节省了不少时间." />
<meta property="og:description" content="调试编译Linux Kernel有时会遇到这种情况, 辛辛苦苦编译了大半天却发现忘了个module. 然而Linux可插拔的module设计能够让我们单独编译单个module, 为我们节省了不少时间." />
<link rel="canonical" href="//blog.c0ldcat.ml/posts/build-only-one-kernel-module/" />
<meta property="og:url" content="//blog.c0ldcat.ml/posts/build-only-one-kernel-module/" />
<meta property="og:site_name" content="c0ldcat’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-03T02:20:06+00:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Linux Kernel 只编译一个module",
"datePublished": "2017-02-03T02:20:06+00:00",
"description": "调试编译Linux Kernel有时会遇到这种情况, 辛辛苦苦编译了大半天却发现忘了个module. 然而Linux可插拔的module设计能够让我们单独编译单个module, 为我们节省了不少时间.",
"url": "//blog.c0ldcat.ml/posts/build-only-one-kernel-module/"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
    <a id="top"></a>
    <div class="container">
        <header class="masthead-bar scoll-up">
            <h1 class="masthead-bar-title">
                <a href="#top" id="scoll-to-top">
                    
                    <span id="masthead-bar-title-page">Linux Kernel 只编译一个module<span> | </span></span>
                    
                <span>c0ldcat<span>&#39;s blog</span></span></a>
            </h1>
        </header>
        <header class="masthead scoll-up">
            <h1 class="masthead-title">
                <a href="/" id="page-title">Linux Kernel 只编译一个module</a><span> | </span>
                <a href="/"><span id="author-name">c0ldcat</span><span>&#39;s blog</span></a>
            </h1>
            <nav class="masthead-nav">
                
                <a href="/posts">文章</a>
                
                <a href="/projects">项目</a>
                
                <a href="/tags">标签</a>
                
                <a href="/about">关于我</a>
                
                
                <a href="/tags/linux">Linux</a>
                
            </nav>
        </header>
        <div class="content post">
  <div class="post-date">
    <time>03 Feb 2017</time>
  </div>
  <p>调试编译Linux Kernel有时会遇到这种情况, 辛辛苦苦编译了大半天却发现忘了个module. 然而Linux可插拔的module设计能够让我们单独编译单个module, 为我们节省了不少时间.</p>

<p>以linux-surfacepro3的cpufreq_stats为例: (linux 4.8之后cpufreq_stats不再以module形式加载)</p>

<p>以内核root目录为work dir</p>

<p>确保work dir下存在<code class="highlighter-rouge">Module.symvers</code>, 没有的话到<code class="highlighter-rouge">/lib/modules/${KERNEL}/build/Module.symvers</code></p>

<p>将kernel config复制到<code class="highlighter-rouge">.config</code></p>

<p>准备工作:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>make prepare
make scripts
</code></pre>
</div>

<p>先找到模块的位置: <code class="highlighter-rouge">drivers/cpufreq</code></p>

<p>以及模块的配置参数: <code class="highlighter-rouge">CONFIG_CPU_FREQ_STAT=m</code></p>

<p>在kernel根目录下编译: <code class="highlighter-rouge">make CONFIG_CPU_FREQ_STAT=m M=drivers/cpufreq modules</code></p>

<p>看make的输出找到生成module的位置并复制到module目录里: <code class="highlighter-rouge">sudo cp drivers/cpufreq/cpufreq_stats.ko /lib/modules/${KERNEL}/kernel/drivers/cpufreq/</code></p>

<p>最后再用<code class="highlighter-rouge">insmod</code>或者<code class="highlighter-rouge">depmod</code>生效即可</p>

</div>

        <footer>
            <hr>
            <p><small>Maintained by <a href="https://github.com/c0ldcat">c0ldcat</a> with <img src="/images/love.svg" /></small><p>
        </footer>
    </div>

    <script type="text/javascript" src="https://cdn.staticfile.org/jquery-hashchange/v1.3/jquery.ba-hashchange.min.js"></script>

    <script>
    function init() {
        window.addEventListener('scroll', function(e){
            var distanceY = window.pageYOffset || document.documentElement.scrollTop,
            shrinkOn = 200,
            header = $("header");
            if (distanceY > shrinkOn) {
                if (header.hasClass("scoll-up")) {
                    header.removeClass("scoll-up");
                }
                header.addClass("scoll-down");
                if ( header.height() / $(window).height() > 0.15 ) {
                    $('#masthead-bar-title-page').css('display', 'none');
                }
            } else {
                if (header.hasClass("scoll-down")) {
                    header.removeClass("scoll-down");
                }
                header.addClass("scoll-up");
            }
            //console.log(distanceY);
        });
        var scollItem = $("#scoll-to-top");
        scollItem.click(function() {
            $.scrollTo(scollItem.attr("href"), {duration:2000});
        });
    }
    $(document).ready(init());

    $(window).hashchange(function(){
        var target = $(location.hash);
        console.log(location.hash);
        if(target.length==1){
            var top = target.offset().top-$('.masthead-bar').height();
            if(top > 0){
                $('html,body').scrollTop(top);
            }
        }
    });

    $(function() {
        $(window).hashchange();
    });
    </script>
</body>
</html>
